/*
 * Copyright (C) 2016 Broadcom
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation version 2.
 *
 * This program is distributed "as is" WITHOUT ANY WARRANTY of any
 * kind, whether express or implied; without even the implied warranty
 * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */

#ifndef __FA2_H__
#define __FA2_H__

int fa2_write_table(struct fa *fa, u32 type, u32 index, u32 *hw_entry);
int fa2_read_table(struct fa *fa, u32 type, u32 index, u32 *hw_entry);
int fa2_init(struct fa *fa);
void fa2_exit(struct fa *fa);

/* WAN port */
#define FA2_WAN_PORT 4

/* CTF_CONTROL register (0x0) */
#define FA2_CTF_CONTROL_OFF		0x0

#define FA2_MUX_CUT_THRU		0x00000200
#define FA2_CRC_OWRT_CONFIG		0x00000100
#define FA2_CRC_FWD_CONFIG		0x00000080
#define FA2_SPU_ENABLE			0x00000040
#define FA2_PAE_ENABLE			0x00000020
#define FA2_FLOW_TBL_CTR_MODE		0x00000010
#define FA2_DISABLE_MAC_DA_CHK		0x00000008
#define FA2_FRAG_ENABLE			0x00000004
#define FA2_MEM_INIT			0x00000002
#define FA2_CTF_MODE			0x00000001
#define FA2_UNIMAC_MIN_PKT_MASK		0x000F7000
#define FA2_UNIMAC_MIN_PKT_SHIFT	13

/* CTF_MEM_ACC_CONTROL (0x4) */
#define FA2_MEM_ACC_CONTROL_OFF		0x4

#define FA2_MEM_SELECT_MODE		0xC0000000
#define FA2_MEM_SELECT_MODE_4K		0x80000000
#define FA2_MEM_SELECT_MODE_2K		0x40000000
#define FA2_MEM_SELECT_MODE_1K		0x00000000
#define FA2_DO_ACCESS			0x20000000
#define FA2_MEM_ACC_BUSY		0x10000000
#define FA2_CURRENT_TABLE_INDEX		0x0FFF0000
#define FA2_RD_WR_N			0x00008000
#define FA2_TABLE_SELECT		0x00007000
#define FA2_TABLE_INDEX			0x00000FFF

/* CTF_BRCM_HDR_CONTROL (0x8) */
#define FA2_BRCM_HDR_CONTROL_OFF	0x8

#define FA2_BRCM_HDR_REASON_CODE_MASK	0x000000FF

/* CTF_L2_SKIP_CONTROL (0xC) */
#define FA2_L2_SKIP_CONTROL_OFF		0xC

#define FA2_ETH2_TO_SNAP_CONVERSION	0x00100000
#define FA2_L2_PARSE_ETYPE_SKIP_ENABLE	0x00080000
#define FA2_L2_PARSE_ETYPE_SKIP_BYTES	0x00070000
#define FA2_L2_PARSE_ETYPE_SKIP		0x0000FFFF

/* CTF_L2_TAG_TYPE (0x10) */
#define FA2_L2_TAG_TYPE_OFF		0x10

#define FA2_L2_PARSE_ETYPE_TAGGED_TYPE1 0xFFFF0000
#define FA2_L2_PARSE_ETYPE_TAGGED_TYPE0 0x0000FFFF

/* CTF_L2_LLC_MAX_LENGTH (0x14) */
#define FA2_L2_LLC_MAX_LENGTH_OFF	0x14

#define FA2_L2_PARSE_LLC_MAX_LENGTH	0x0000FFFF

#define FA2_L2_LLC_SNAP_TYPE_LO_OFF	0x18
#define FA2_L2_LLC_SNAP_TYPE_HI_OFF	0x1C
#define FA2_L2_ETHERTYPE_OFF		0x20
#define FA2_L2_PARSE_PPOE_OFF		0x24

/* CTF_L2_ET_BYPASS (0x28) */
#define FA2_L2_ET_BYPASS_OFF		0x28

#define FA2_L2_ET_BYPASS1		0xFFFF0000
#define FA2_L2_ET_BYPASS0		0x0000FFFF

/* CTF_HDR_EDIT_CONTROL (0x2C) */
#define FA2_HDR_EDIT_CONTROL_OFF	0x2C

#define FA2_MODIFY_BRCM_HDR_ERRORS	0x00000002

#define FA2_DECREMENT_TTL		0x00000001

#define FA2_L3_PARSE_PPPOE_PROTO_OFF	0x30
#define FA2_L3_PARSE_IPV4_NEXT_HDR_UDPTCP_OFF	0x34
#define FA2_L3_PARSE_IPV6_NEXT_HDR_UDPTCP_OFF	0x38

/* CTF_L3_PARSE_IPV6_NEXT_HDR_CFG (0x3C) */
#define FA2_L3_PARSE_IPV6_NEXT_HDR_CFG_OFF	0x3C

#define FA2_L3_PARSE_IPV6_NEXT_HDR_CFG0 0xFF000000
#define FA2_L3_PARSE_IPV6_NEXT_HDR_CFG1 0x00FF0000
#define FA2_L3_PARSE_IPV6_NEXT_HDR_CFG2 0x0000FF00
#define FA2_L3_PARSE_IPV6_NEXT_HDR_CFG3 0x000000FF

#define FA2_L3_PARSE_IPV4_NEXT_HDR_CFG_OFF	0x40

/* CTF_L3_IPV4_CONTROL (0x44) */
#define FA2_L3_IPV4_CONTROL_OFF		0x44

#define FA2_L3_PARSE_CHECKSUM_ENABLE 0x00000001

/* CTF_PARSE_MC (0x48) */
#define FA2_PARSE_MC_OFF		0x48

#define FA2_PARSE_MC_ENABLE		0x00000004
#define FA2_PARSE_MC_PROTO		0x00000002
#define FA2_PARSE_MC_PORTS		0x00000001

/* CTF_HASH_SEED (0x4C) */
#define FA2_HASH_SEED_OFF		0x4C

#define FA2_HASH_SEED			0x0000FFFF

#define FA2_NSP603_OFF			0x50

/* CTF_FLOW_MISCONFIG_ID (0x54) */
#define FA2_FLOW_MISCONFIG_ID_OFF	0x54
#define FA2_FLOW_MISCONFIG_FLOW_ID	0x00000FFF

/* CTF_FLOW_TIMEOUT_CONTROL (0x58) */
#define FA2_FLOW_TIMEOUT_CONTROL_OFF	0x58

#define FA2_FLOW_TIMEOUT_CTRL_TCP_SYN_BYPASS_LKUP	0x00040000
#define FA2_FLOW_TIMEOUT_CTRL_HW_TIMEOUT_MSG_ENABLE	0x00020000
#define FA2_FLOW_TIMEOUT_CTRL_FLOW_ENTRY_POINTER	0x0001FFE0
#define FA2_FLOW_TIMEOUT_CTRL_FIFO_DEPTH		0x0000001F

/* CTF_FLOW_TIMER_CONFIG0 (0x5C) */
#define FA2_FLOW_TIMER_CONFIG0_OFF	0x5C

#define FA2_FLOW_TIMER_CONFIG0_UDP_EST_SHIFT	4
#define FA2_FLOW_TIMER_CONFIG0_TCP_EST_SHIFT	2
#define FA2_FLOW_TIMER_CONFIG0_TCP_FIN_SHIFT	0

/* CTF_FLOW_TIMER_CONFIG0 (0x60) */
#define FA2_FLOW_TIMER_CONFIG1_OFF	0x60

#define FA2_FLOW_TIMER_CONFIG1_UDP_EST_SHIFT	16
#define FA2_FLOW_TIMER_CONFIG1_TCP_EST_SHIFT	8
#define FA2_FLOW_TIMER_CONFIG1_TCP_FIN_SHIRT	0

/* CTF_FLOW_TIMER_CONFIG0 (0x64) */
#define FA2_FLOW_TIMER_CONFIG2_OFF	0x64

#define FA2_FLOW_TIMER_CONFIG2_UDP_EST_KEEPALIVE_EN	0x00000004
#define FA2_FLOW_TIMER_CONFIG2_TCP_EST_KEEPALIVE_EN	0x00000002
#define FA2_FLOW_TIMER_CONFIG2_TCP_FIN_KEEPALIVE_EN	0x00000001

/* CTF_STATUS (0x68) */
#define FA2_STATUS_OFF			0x68

#define FA2_STATUS_BRCM_HDR_CHK_OUT_OF_RANGE		0x80000000
#define FA2_STATUS_BRCM_HDR_CHK_CRC_ERROR		0x40000000
#define FA2_STATUS_BRCM_HDR_CHK_UNKNOWN_TYPE		0x20000000
#define FA2_STATUS_BRCM_HDR_CHK_PROC_OP_FAIL		0x10000000
#define FA2_STATUS_BRCM_HDR_CHK_EXCEPTION		0x08000000
#define FA2_STATUS_L2_HDR_CHK_SNAP_FAIL			0x04000000
#define FA2_STATUS_L2_HDR_CHK_ETYPE_FAIL		0x02000000
#define FA2_STATUS_L2_HDR_CHK_PPPOE_LEN_FAIL		0x01000000
#define FA2_STATUS_L2_HDR_CHK_PPPOE_DISCOVERY_FAIL	0x00800000
#define FA2_STATUS_L2_HDR_CHK_PPPOE_PROT_FAIL		0x00400000
#define FA2_STATUS_L3_HDR_CHK_VERSION_FAIL		0x00200000
#define FA2_STATUS_L3_HDR_CHK_TTL_FAIL			0x00100000
#define FA2_STATUS_L3_HDR_CHK_IPV4_OPTIONS_FAIL		0x00080000
#define FA2_STATUS_L3_HDR_CHK_IPV4_HDR_LEN_FAIL		0x00040000
#define FA2_STATUS_L3_HDR_CHK_IPV4_CHKSUM_FAIL		0x00020000
#define FA2_STATUS_L3_HDR_CHK_IPV4_FRAG_FAIL		0x00010000
#define FA2_STATUS_L2_HDR_CHK_SNAP_CONVERSION_FAIL	0x00008000
#define FA2_STATUS_L2_HDR_CHK_DA_MISS			0x00004000
#define FA2_STATUS_L2_HDR_CHK_BRCM_HDR_DIR_MISMATCH	0x00002000
#define FA2_STATUS_L2_HDR_CHK_FLOW_DIR_MISMATCH		0x00001000
#define FA2_STATUS_L2_HDR_CHK_PPPOE_SESSION_MISS	0x00000800
#define FA2_STATUS_L2_HDR_CHK_REVERSE_MISMATCH		0x00000400
#define FA2_STATUS_L2_HDR_CHK_INBOUND_MISS		0x00000200
#define FA2_STATUS_L2_HDR_CHK_OUTBOUND_MISS		0x00000100
#define FA2_STATUS_L2_HDR_CHK_PPPOE_INTERNAL_PORT	0x00000080
#define FA2_STATUS_L2_HDR_CHK_PPPOE_BINDING_FAIL	0x00000040
#define FA2_STATUS_L3_HDR_CHK_IPV6_FRAG_MTU_FAIL	0x00000020
#define FA2_STATUS_L3_HDR_CHK_IPV4_FRAG_DF		0x00000010
#define FA2_STATUS_L3_HDR_CHK_FRAG_DISABLED		0x00000008
#define FA2_STATUS_L3_HDR_CHK_FRAG_PKT_TOO_LARGE	0x00000004
#define FA2_STATUS_FLOW_TIMEOUT_FIFO_NONEMPTY		0x00000002
#define FA2_STATUS_INIT_DONE 0x00000001

#define FA2_STATUS_ENABLE_OFF		0x6C

/* CTF_STATUS_FWD0 (0x70) */
#define FA2_STATUS_FWD0_OFF		0x70

#define FA2_STS_FWD0_L2_HDR_CHK_PPPOE_PROT_FAIL		0xC0000000
#define FA2_STS_FWD0_L2_HDR_CHK_PPPOE_DISCOVER_FAIL	0x30000000
#define FA2_STS_FWD0_L2_HDR_CHK_PPPOE_BINDING_FAIL	0x0C000000
#define FA2_STS_FWD0_L2_HDR_CHK_PPPOE_SESSION_MISS	0x03000000
#define FA2_STS_FWD0_L2_HDR_CHK_SNAP_FAIL		0x00C00000
#define FA2_STS_FWD0_L2_HDR_CHK_SNAP_CONVERT_FAIL	0x00300000
#define FA2_STS_FWD0_L2_HDR_CHK_ETYPE_FAIL		0x000C0000
#define FA2_STS_FWD0_L3_HDR_CHK_VERSION_FAIL		0x00030000
#define FA2_STS_FWD0_L3_HDR_CHK_IPV4_OPTIONS_FAIL	0x0000C000
#define FA2_STS_FWD0_L3_HDR_CHK_IPV4_HDR_LEN_FAIL	0x00003000
#define FA2_STS_FWD0_L3_HDR_CHK_IPV4_CHKSUM_FAIL	0x00000C00
#define FA2_STS_FWD0_L3_HDR_CHK_IPV4_FRAG_FAIL		0x00000300
#define FA2_STS_FWD0_L3_HDR_CHK_IPV6_FRAG_MTU_FAIL	0x000000C0
#define FA2_STS_FWD0_L3_HDR_CHK_IPV4_FRAG_DF		0x00000030
#define FA2_STS_FWD0_L3_HDR_CHK_FRAG_DISABLED		0x0000000C
#define FA2_STS_FWD0_L3_HDR_CHK_FRAG_PKT_TOO_LARGE	0x00000003

/* CTF_STATUS_FWD1 (0x74) */
#define FA2_STATUS_FWD1_OFF		0x74

#define FA2_STS_FWD1_L2_ETYPE_BYPASS			0xC0000000
#define FA2_STS_FWD1_BRCM_HDR_CRC_ERR			0x30000000
#define FA2_STS_FWD1_PPPOE_ON_INTERNAL_PORT		0x0C000000
#define FA2_STS_FWD1_L3_CFG_PROTOCOL_MISS		0x03000000
#define FA2_STS_FWD1_L4_TCP_SYN_FLAG			0x00C00000
#define FA2_STS_FWD1_LKUP_REVERSE_MISMATCH		0x00300000
#define FA2_STS_FWD1_LKUP_INBOUND_NAPT_MISS		0x000C0000
#define FA2_STS_FWD1_LKUP_OUTBOUND_NAPT_MISS		0x00030000
#define FA2_STS_FWD1_BRCM_HDR_CHK_OUT_OF_RANGE		0x0000C000
#define FA2_STS_FWD1_BRCM_HDR_CHK_UNKNOWN_TYPE		0x00003000
#define FA2_STS_FWD1_BRCM_HDR_CHK_PROC_OP		0x00000C00
#define FA2_STS_FWD1_BRCM_HDR_CHK_EXCEPTION		0x00000300
#define FA2_STS_FWD1_L2_HDR_CHK_BRCM_HDR_DIR_MISM	0x000000C0
#define FA2_STS_FWD1_L2_HDR_CHK_FLOW_DIR_MISMATCH	0x00000030
#define FA2_STS_FWD1_L2_HDR_CHK_DA_MISS			0x0000000C
#define FA2_STS_FWD1_L2_HDR_CHK_PPPOE_LEN_FAIL		0x00000003

/* CTF_STATUS_FWD2 (0x78) */
#define FA2_STATUS_FWD2_OFF		0x78

#define FA2_STS_FWD2_L2_HDR_HOST_DMAC_MISS		0x0000000C
#define FA2_STS_FWD2_L3_HDR_TTL_FAIL			0x00000003

/* CTF_HIT_COUNT (0x7c) */
#define FA2_HIT_COUNT_OFF		0x7C
#define FA2_MISS_COUNT_OFF		0x80
#define FA2_NAPT_FLOW_MISS_COUNT_OFF	0x84
#define FA2_TUNNEL_DROP_COUNT_OFF	0x88
#define FA2_FRAG_PKTS_COUNT_OFF		0x8C

/* CTF_ERROR (0x90) */
#define FA2_ERROR_OFF			0x90

#define FA2_ERR_CHKSUM_FLOW_INV_CONFIG		0x00000100
#define FA2_ERR_CHKSUM_ROUTER_MAC_INV		0x00000080
#define FA2_ERR_SPU_DISABLED_ERROR		0x00000040
#define FA2_ERR_SPU_KEK_OP_ERROR		0x00000020
#define FA2_ERR_SPU_KEK_UCOR_ECC_ERROR		0x00000010
#define FA2_ERR_SPU_KEK_CORR_ECC_ERROR		0x00000008
#define FA2_ERR_FRAG_FIFO_OVERFLOW_ERROR	0x00000004
#define FA2_ERR_MAC_FIFO_OVERFLOW_ERROR		0x00000002
#define FA2_ERR_TXQ_FIFO_OVERFLOW_ERROR		0x00000001

#define FA2_ERROR_ENABLE_OFF		0x94

/* CTF_BACKPRESSURE_CONTROL (0x98) */
#define FA2_BACKPRESSURE_CONTROL_OFF	0x98

#define FA2_BKP_FRAG_FIFO_LEVEL	0x3C000000
#define FA2_BKP_MAC_PKTS		0x03C00000
#define FA2_BKP_MAC_LEVEL		0x003FE000
#define FA2_BKP_TXQ_PKTS		0x00001E00
#define FA2_BKP_TXQ_LEVEL		0x000001FF

/* CTF_DRR_CONFIG (0x9C) */
#define FA2_DRR_CONFIG_OFF		0x9C

#define FA2_DRR_CONFIG_REFRESH_MODE	0x00100000
#define FA2_DRR_CONFIG_QUANTUM		0x000F0000
#define FA2_DRR_CONFIG_MAC_WEIGHT	0x00003F80
#define FA2_DRR_CONFIG_MAC_WEIGHT_SHIFT	7
#define FA2_DRR_CONFIG_TXQ_WEIGHT	0x0000007F

#define FA2_DEBUG_CONTROL_OFF		0xA0
#define FA2_MEM_DEBUG_OFF		0xA4
#define FA2_ECC_ERR_CORR_STATUS_OFF	0xA8
#define FA2_ECC_ERR_UCOR_STATUS_OFF	0xAC
#define FA2_ECC_DEBUG_OFF		0xB0
#define FA2_FIFO_DEBUG0_OFF		0xB4
#define FA2_FIFO_DEBUG1_OFF		0xB8
#define FA2_SPU_DEBUG0_OFF		0xBC
#define FA2_SPU_DEBUG1_OFF		0xC0
#define FA2_SPU_DEBUG2_OFF		0xC4
#define FA2_SPU_DEBUG3_OFF		0xC8
#define FA2_SPU_DEBUG4_OFF		0xCC
#define FA2_SPU_DEBUG5_OFF		0xD0

/* CTF_SER_EVENT (0xD4) */
#define FA2_SER_EVENT_OFF		0xD4

#define FA2_SER_EVENT_ECC_ERR_UCOR_DOUBLE	0x00000010
#define FA2_SER_EVENT_ECC_ERR_CORR_DOUBLE	0x00000008
#define FA2_SER_EVENT_ECC_ERR_UCOR		0x00000002
#define FA2_SER_EVENT_ECC_ERR_CORR		0x00000001

#define FA2_SER_EVENT_ENABLE_OFF	0xD8

/* CTF_HDR_CHECK_COUNT 0xDC) */
#define FA2_HDR_CHECK_COUNT_OFF		0xDC
#define FA2_NUM_HDR_CHECKS		35

#define FA2_MEM_ACC_DATA0_OFF		0x168
#define FA2_MEM_ACC_DATA1_OFF		0x16C
#define FA2_MEM_ACC_DATA2_OFF		0x170
#define FA2_MEM_ACC_DATA3_OFF		0x174
#define FA2_MEM_ACC_DATA4_OFF		0x178
#define FA2_MEM_ACC_DATA5_OFF		0x17C
#define FA2_MEM_ACC_DATA6_OFF		0x180

#endif /* __FA2_REGS_H__ */
